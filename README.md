# 掘金仿真服务使用手册



## 产品与服务

-------
掘金仿真交易是为量化投资者打造的一个最接近真实市场环境的仿真平台，旨在以坚实的IT技术，助力化量化投研与投资。
本服务主要面向量化投研机构和个人服务，提供整套证券仿真交易的信息化技术平台

投资者可通过掘金官网注册（ https://www.myquant.cn ）后使用。
本服务适用于量化策略开发的检验、测试、优选，提高投资策略实战能力；也提供独立部署，用于证券投研、培训、教育及投资大赛

## 基本功能使用指引

仿真交易包含：`界面-手动交易`和`接口-自动化交易`。

WEB界面用于手动交易和查看账户情况；接口用于策略交易，包含多种语言且用法相近

### 新建账户

先登录掘金账户，未注册用户请点击首页右上角的新用户注册，注册一个用户。
建仿真交易账户
第一步：选择账户类型


![仿真账户](uploads/201903/20190428182412.png)

第二步：输入账户名称并设置初始资金
第三步：新建完成后，账户会显示在仿真账户管理页面

![仿真账户](uploads/201903/attach_158df9c655e4237a.png)

**关于账户的重要说明**

- token是掘金服务的唯一身份识别，用于后台响应请求的身份验证
- accounID是仿真系统账户的编码，用于仿真服务识别仿真账户身份
- 在线仿真服务和掘金量化终端共用仿真账户
- 普通账户权限最多申请4个仿真账户
- 仿真交易账户类型分为股票和期货，新建时必须选定类型

### 手工交易

手工交易采用经典的行情+下单版的组合方式，提供股票和期货两种类型

![仿真交易](uploads/201903/attach_158e29f240e954b4.png)


> 交易界面采用WebSocket全双工通信的协议，可以同步监控当前账户的交易情况，比如监控策略交易情况


### 设置手续费和资金

- 账户的交易手续费和资金设置即时生效，仅对当前账户有效
- 股票精确到交易市场，默认为10%%，最小单笔费用5元
- 期货精确到品种，默认值同步交易所公布的最新合约数据
- 出入金可以直接增减资金，并记录了资金增减流水


![账户信息查看和设置](uploads/201903/attach_158e28cdabc2eb14.png)

### 交易数据下载和分析

`交易数据下载` 提供`CSV格式`的当前账户所有数据,包含资金，持仓，历史委托，历史成交

>交易数据下载功能在服务端验证了用户权限，用户仅可以下载当前账户交易数据

`绩效分析`直接将交易数据转接到绩效分析服务，并供完整的绩效分析报告

![绩效分析](uploads/201903/attach_158e28cdabc2eb15.png)

## API交易接入指引

### 下载仿真交易SDK

**python交易SDK下载**
- 版本支持： Python3.6 +
- 操作系统： Windows64/32;  Linux64/32
- 安装包存放在pypi仓库中，推荐用标准库安装方式安装`gmtrade`在cmd窗口python.exe文件目录下执行
  
```
    pip install gmtrade
```

**C++交易SDK下载：**

操作系统：Windows 64/32; Linux 64/32

点击下载：[Windows版](https://www.myquant.cn/download/sdk?type=2&platform=windows&lang=cpp)

点击下载：[Linux版](https://www.myquant.cn/download/sdk?type=2&platform=linux&lang=cpp)

### 配置服务地址

仿真服务的API接入地址（ip:port)是sim.myquant.cn:80
```
set_endpoint("sim.myquant.cn:80")
```

### 仿真账户登录

- 交易接口需要`预先声明（token）和账户ID（accountID）`。
- 登录官网右上角`用户->个人中心->安全设置`获取和修改：
- 通过login(account_id)登录账户，登录成功后，可直接执行交易和查询
- 多账户场景下需指定账户进行查询，且仅登录后的账户用。


![账户信息查看和设置](uploads/201903/attach_20190416145213.png)

仿真账户登录示例代码
```
# 本示例运行于python3.6及以上版本
from gmtrade.api import *

# token身份认证
set_token("your token")

# 示例中为掘金官方仿真服务地址；如API接入掘金终端，则填空字符串
set_endpoint("sim.myquant.cn")

# 登录账户，account_id为账户ID，必填；account_alias为账号别名，选填
a1 = account(account_id='', account_alias='')
# 可login多个账户，如login(a1, a2, a3)
login(a1)  

```

### 进行交易和查询

具体使用请参考SDK文档的示例和API说明，以下是交易/查询API一览

```python

# 按指定量委托,返回order结构
order_volume()

# 批量委托接口，返回多条order结构
order_batch() 

# 撤销委托
order_cancel()

# 撤销所有委托
order_cancel_all()
 
# 平当前所有可平持仓
order_close_all()

# 查询日内全部未结委托，返回order结构
get_unfinished_orders()
 
# 查询日内全部执行回报
get_execution_reports()
 
# 查询账户持仓，返回position结构
get_position()

# 查询账户资金，返回cash结构
get_cash()


```

接口的返回值通过标准的order、execrpt、cash、position等固定结构的对象返回，具体参照各语言接口字段对象


### 更及时获取交易信息
通过事件回调的方式获取交易信息，由服务器主推，速度更快、更及时

预先调用start()来启动消息推送，通过柜台主推信息到`指定函数`的方式进行,且要`保持启动的进程不退出`
通过stop() 停止事件接收

交易事件一览
```
# 委托状态更新事件
on_order_status

# 委托执行回报事件
on_execution_report

# 交易账户状态更新事件
on_account_status

# 交易通道网络连接成功事件
on_trade_data_connected

# 交易通道网络连接断开事件
on_trade_data_disconnected

# 错误事件
on_error
```


事件回调的参数字段格式参照各语言接口字段对象

## 交易规则说明

#### 支持市场： 
- 上交所，深交所，中金所，大商所，郑商所，上期所，上海能源交易所

#### 支持品种： 
- 沪深A股，基金，商品期货，股指期货

#### 撮合引擎：
- 精准撮合:  交易时段撮合；委托按价格优先、时间优先规则，与实时行情盘口数据精准撮合。
- 现价撮合:  全天实时撮合；委托与交易标的最新价或指定限价进行撮合。用于满足随时调试策略的场景。

#### 结算规则： 
- 实时结算模式：盘中交易时，根据交易实时结算账户的资金和持仓数据。
- 盘后结算模式：盘后校验账户全天交易数据；期货合约过期自动交割。

#### 手续费规则： 
- 股票的佣金/印花税/过户费，支持按设定的费率收取。
- 期货的手续费，支持按交易方向/交易额/交易手数收取。

#### 保证金规则：
- 期货保证金比率按交易所默认的规则设置。

#### 分红送配： 
- 股票账户自动根据分红配送数据，调整账户的资金和持仓数量。

#### 委托类型： 
- 支持股票与期货的市价单/限价单
- 支持`FAK/FOK/GFD/BOC/BOP/B5TC/B5TL`等交易属性设置

#### 委托验证： 
- 支持委托验证：开仓验资/平仓验券/标的代码/价格/数量等字段合法性

#### 交易时段： 
- 期货市场日盘/夜盘，与交易所真实规则相同
- 股票市场集合竞价时段，连续竞价交易时段

#### 资金调整： 
- 支持对账户资金转入转出。

#### 挂单冻结： 
- 开仓委托尚未成交时，冻结对应资金；
- 平仓委托尚未成交时，冻结对应持仓；
- 委托已成/已撤/过期时，解除对应冻结。

## 交易时间与特殊事件

每个市场支持：`初始化时间，开市时间，收市时间，结算时间`4个特殊的时间点，在每个时间点对应市场可能根据需要处理一些事务。

#### 初始化时间
- 沪深交易所：09:00:00
- 期货交易所：20:00:00
- 事务处理：
	1.持仓的今昨仓数量调整
	2.处理股票分红派送
	
#### 开市时间
- 同真实交易所开市时间
- 事务处理：
	无

#### 收市时间
- 同真实交易所收市时间
- 事务处理：
	1.自动过期日内未成交的挂单

#### 结算时间
- 沪深交易所：18:00:00
- 期货交易所：18:00:00
- 事务处理：
	无
  
#### 竞价交易与连续交易
- 竞价交易/连续交易/中途休市时间设置，同真实交易所。
- 事务处理：
	1.自动交割过期合约的持仓
	2.使用结算价或最新价，更新账户的资金与持仓



## 常见问题回答（FAQ）

### 我可以创建多少个账户？
每个用户可以创建`2`个股票账户，`2`个期货账户。

### 我每天可以委托多少笔？
每个账户每天可以交易`1000`笔。限制交易委托数是为了防止策略错误和恶意滥用服务资源，保障柜台和撮合服务质量，以免影响其他用户正常使用。

### 我的交易数据会保留多久？
永久保留，除非您自己删除账户。账户超过`3`个月没有交易时，会被设置为“未激活”状态，不能交易；重新交易需要手工“激活”账户。

### 我还其它有疑问，我希望合作
如果您遇到其它疑问以上未能回答，可以在[社区](https://www.myquant.cn/community/)提问，或者加入掘金技术支持群，我们会及时解答。
商务合作，请联系：